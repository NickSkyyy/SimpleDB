# Lab 1 report

> 姓名：戚晓睿
>
> 学号：1811412
>
> Github: https://github.com/NickSkyyy/SimpleDB
>
> GitCommitPic: see it below

![](E:\Java\SimpleDB\GitCommitPic.png)

## 1 设计思路

Lab1设计的是数据库比较基础的部分，初步建立起了Schema（TupleDesc.java）、Tuple（Tuple.java)、Table（HeapFile.java)等基本元素，以及为后续操作提供方便的全局BufferPool（BufferPool.java）、Catalog（Catalog.java）等。

由于是初上手SimpleDB的实现，在设计过程中将侧重点放在了实现功能上面，用简单的数据结构和较为有效的算法实现了Lab1的所有内容。

第二部分将详细地分块介绍每一个实现的内容、难点与自己的思考。



## 2 详细介绍

### 2.1 TupleDesc & Tuple

建立基础的Schema和Tuple，实现起来较为简单，没有特别难的地方。主要介绍两个方法：TupleDesc.merge，TupleDesc.equals

#### 2.1.1 TupleDesc.merge

```java
public static TupleDesc merge(TupleDesc td1, TupleDesc td2)
```

考虑到传入的td有可能为**null**，空指针操作十分危险，在这里设计了长度的分类判断。

```java
if (td1 == null)
	len = td2.numFields();
else if (td2 == null)
	len = td1.numFields();
else
	len = td1.numFields() + td2.numFields();
```

len代表了merge之后的TupleDesc长度

#### 2.1.2 TupleDesc.equals

上学期学了java，这一部分只提一下对Object的处理

```java
if (o instanceof TupleDesc) {
	TupleDesc td = (TupleDesc)o;
	...
}
```

**instanceof**对Object进行判断，如果是TupleDesc的实体类对象，则进行第2行的强制转换，之后才能进行两个同样对象间的比较。

### 2.2 Catalog

在一开始设计的时候我使用的下面的数据结构：

```java
private Map<String, Pair<DbFile, String>> tables;	// table name to table & key
private Map<Integer, String> ids;   // id to table name
```

但是在后面的实践过程中发现Pair的加入并没有起到很好的帮助，反而在取出内容的过程中导致操作繁琐，于是将Pair对应项拆开变成下面的三个HashMap：

```java
private Map<String, DbFile> tables;   // table name to table
private Map<String, String> keys;   // table name to key
private Map<Integer, String> ids;   // id to table name
```

这样对应到每一个需要的Value取值就不会像使用Pair那样充满限制。java自带的HashMap封装很好，Key和Value之间可以互相取到，非常方便。

### 2.3 BufferPool

配合HeapFile，这里是Lab1中最难理解和实现的地方之一。在首次撰写的时候，仅仅完成了小部分功能，并打好if判断的框架

